<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<link rel="stylesheet" href="./baseTemplate.css"></style>
<style>
    body {
        font-variant-emoji: emoji;
        margin: 0;
    }
    .card-text {
        font-size: large;
    }
    .header {
        font-size: medium;
    }
    .card-container {
        display: inline-grid;
        /* 10x7 */
        grid-auto-flow: row;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(7, 1fr);
        column-gap: 0;
        row-gap: 0;
        overflow: visible;
    }

    .event.card {
        border: 3px solid black;
        width: 325px;
        height: 325px;
        margin: 2px;
        padding: 0px;
        display: table;
        background-color: white;
    }
    .event {
        
    
        .left-edge,.right-edge {
            display:table-cell;
            width: 15%;
            height: 100%;
            padding: 0;
            margin: 0;
            text-align: center;
            font: 18px Arial, sans-serif;
        }
        .left-edge {
            border-right: 3px dashed black;
        }
        .card-center {
            display:table-cell;
            height: 100%;
            padding: 10px;
            padding-bottom: 0px;
        }
        .card-title {
            text-align: center;
        }
        .health {
            float: inline-start;
            text-align: left;
            width: min-content;
    
    
        }
        .time {
            
            float: right;
            text-align: center;
        }
        .card-center * {
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .right-edge {
    
            border-left: 3px dashed black;
    
        }
    
    
        .card-text {
            font: 18px Arial, sans-serif;
        }
        .header {
            width: 100%;
            height: 10%;
        }
        .header *{
            display:inline-block;
        }
        .card-art {
            /*width:100%;*/
            aspect-ratio: 2/1;
            object-fit: cover;
        }
    
    }
    .enemy.card {
        border-left-style: dashed;
        
    }
    .enemy {
        .card {
            border-left-style: dashed;
        }
    
    
        .health {
            float: inline-start;
            text-align: left;
            width: min-content;
        }
    
    
    
        .card-text {
            font: 18px Arial, sans-serif;
        }
        .header {
            width: 100%;
            height: 10%;
        }
        .header *{
            display:inline-block;
        }
        .card-art {
            aspect-ratio: 1.2/1;
        }
    }

</style>
</head>
<body>
<template id="AttackTemplate">
<div class="card action">
    {{#if leftEffects}}
    <div class="left-edge">
        {{#each leftEffects}}
        <p>{{this}}</p>
        {{/each}}
    </div>
    {{/if}}
    <div class="card-center">
        <div class="header">
        <h1 class="health">{{health}}</h1>

        <h1 class="card-title">{{title}}</h1>
        <h1 class="time">{{time}}</h1>

        </div>
        <h3 class="level">{{level}}</h3>
        <h3 class="type">{{type}}</h3>
        <div class="card-art">
            {{#if image}}
            <img src="{{image}}" alt="{{title}}Art">
            {{else}}
            <p>{{title}} art<p>
            {{/if}}
        </div>
        <div class="card-text">
            
            {{#each effects}}
            <p>{{this}}</p>
            {{/each}}
        </div>
    </div>
    {{#if rightEffects}}
    <div class="right-edge">
        {{#each rightEffects}}
        <p>{{this}}</p>
        {{/each}}
    {{/if}}
</div>
</template>
<template id="EnemyTemplate">
    <div class="card enemy">
        <div class="card-center">
            <div class="header">
            <h1 class="health">{{health}}</h1>
    
            <h1 class="card-title">{{title}}</h1>
            <h1 class="time">{{time}}</h1>
    
            </div>
            <h3 class="level">{{level}}</h3>
            <h3 class="type">{{type}}</h3>
            <div class="card-art">
                {{#if image}}
                <img src="{{image}}" alt="{{title}}Art" width="100%" height="100%">
                {{else}}
                <p>{{title}} art<p>
                {{/if}}
            </div>
            <div class="card-text">
                
                {{#each effects}}
                <p>{{this}}</p>
                {{/each}}
            </div>
        </div>
    </div>
    </template>
    <template id="EventTemplate">
        <div class="card event">
            {{#if leftEffects}}
            <div class="left-edge">
                {{#each leftEffects}}
                <p>{{this}}</p>
                {{/each}}
            </div>
            {{/if}}
            <div class="card-center">
                <div class="header">
                <h1 class="health">{{health}}</h1>
        
                <h1 class="card-title">{{title}}</h1>
                <h1 class="time">{{time}}</h1>
        
                </div>
                <h3 class="level">{{level}}</h3>
                <h3 class="type">{{type}}</h3>
                <div class="card-art">
                    {{#if image}}
                    <img src="{{image}}" alt="{{title}}Art" width="100%" height="100%">
                    {{else}}
                    <p>{{title}} art<p>
                    {{/if}}
                </div>
                <div class="card-text">
                    
                    {{#each effects}}
                    <p>{{this}}</p>
                    {{/each}}
                </div>
            </div>
            {{#if rightEffects}}
            <div class="right-edge">
                {{#each rightEffects}}
                <p>{{this}}</p>
                {{/each}}
            {{/if}}
        </div>
        </template>
<button onclick="downloadAll()">Save All</button>
<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script src="./dom-to-image.min.js"></script>
<script src="./baseScript.js"></script>
<script type="text/javascript">
    const attackTemplateScript = Handlebars.compile(document.getElementById('AttackTemplate').innerHTML);
    const enemyTemplateScript = Handlebars.compile(document.getElementById('EnemyTemplate').innerHTML);
    const eventTemplateScript = Handlebars.compile(document.getElementById('EventTemplate').innerHTML);
    function run() {
        /*
        var attackTemplate = document.getElementById('AttackTemplate');
        var attackTemplateHTML = attackTemplate.innerHTML;
        items.forEach(card=>setimage(card))
        actions.forEach(setimage);
        allCards = [...actions, ...items]
        
        let current = actions;
        applyEffects(allCards);
        var attackTemplateScript = Handlebars.compile(attackTemplateHTML);
        //var attackHTML = attackTemplateScript(card);
        //document.write(attackHTML); 
        for(card of current) {
            var attackHTML = attackTemplateScript(card);
            document.write(attackHTML);
        }
        */
        renderLevel(cards.level1, 1);
        renderLevel(cards.level2, 2);
        renderLevel(cards.level3, 3);
    }
    function fixLevel(cards, level) {
        [cards.monsters, cards.actions, cards.items, cards.events].forEach(cardType => {
            cardType.forEach(card => {
                card.level = level;
            });
        });
    }
    function renderLevel(level, number) {
        const allCards = [...level.monsters, ...level.actions, ...level.items, ...level.events];
        fixActions(level.actions);
        fixLevel(level, number);
        applyEffects(allCards);
        renderCards(level.monsters, enemyTemplateScript, `monsters${number}`);
        renderCards(level.actions, attackTemplateScript , `actions${number}`);
        renderCards(level.items, attackTemplateScript , `items${number}`);
        renderCards(level.events, eventTemplateScript , `events${number}`);
    }
    function fixActions(actions) {
        for(const action of actions) {
            if (!action.leftEffects) {
                action.leftEffects = [""];
            }
        }
    }

    function renderCards(cards, template, name) {
        const container = document.createElement('div');
        container.classList.add('card-container');
        container.id = name;
        cards.forEach(card => {
            const html = template(card);
            //document.write(html);
            container.innerHTML += html;
        });
        document.body.appendChild(container);
    }

    function Save(cards) {
        for (let i = 0; i < cards.length; i++) {
            domtoimage.toPng(document.getElementsByClassName("card")[i])
                .then(function (dataUrl) {
                    var img = new Image();
                    img.src = dataUrl;
                    document.body.appendChild(img);
                })
                .catch(function (error) {
                    console.error('oops, something went wrong!', error);
                });
        }
    }

    function saveGroup(div) {
        domtoimage.toPng(div)
            .then(function (dataUrl) {
                var img = new Image();
                img.src = dataUrl;
                document.body.appendChild(img);
            })
            .catch(function (error) {
                console.error('oops, something went wrong!', error);
            });
    }

    /*
      function download(cards, name) {
        for (let i = 0; i < cards.length; i++) {
            domtoimage.toPng(document.getElementsByClassName("card")[i])
                .then(function (dataUrl) {
                    var link = document.createElement('a');
                    link.download = 'card' + name + "_" + i + '.png';
                    link.href = dataUrl;
                    link.click();
                })
                .catch(function (error) {
                    console.error('oops, something went wrong!', error);
                });
        }
    }*/
    function downloadDeck(div, name) {
        domtoimage.toPng(div)
            .then(function (dataUrl) {
                var link = document.createElement('a');
                link.download = name + '.png';
                link.href = dataUrl;
                link.click();
            })
            .catch(function (error) {
                console.error('oops, something went wrong!', error);
            });

    }

    function downloadAll() {
        downloadDeck(document.getElementById('monsters1'), "monsters1");
        downloadDeck(document.getElementById('actions1'), "actions1");
        downloadDeck(document.getElementById('items1'), "items1");
        downloadDeck(document.getElementById('events1'), "events1");
        downloadDeck(document.getElementById('monsters2'), "monsters2");
        downloadDeck(document.getElementById('actions2'), "actions2");
        downloadDeck(document.getElementById('items2'), "items2");
        downloadDeck(document.getElementById('events2'), "events2");
        downloadDeck(document.getElementById('monsters3'), "monsters3");
        downloadDeck(document.getElementById('actions3'), "actions3");
        downloadDeck(document.getElementById('items3'), "items3");
        downloadDeck(document.getElementById('events3'), "events3");

    }

    let cards = {
        "level1": {
            "monsters": [
                {
                    "title": "Dissolving Slime",
                    "health": 1,
                    "time": 2,
                    "effects" : [
                        "1A: Discard a card from your hand"
                    ]
                },
                {
                    "title": "Ruthless Goblin",
                    "health": 3,
                    "time": 1,
                    "effects" : [
                        "1A: /R[1-3] Deal 1D damage",
                        "1A: Deal 1D damage and apply +1T"
                    ]
                },
                {
                    "title": "Twinkling Faerie",
                    "health": 2,
                    "time": 1,
                    "effects" : [
                        "1A: Hide a card from your hand",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Rusting Golem",
                    "health": 3,
                    "time": 1,
                    "effects" : [
                        "1A: Deal 1D damage",
                        "1A: Move an attack from this card to another monster or into your hand"
                    ]
                },
                {
                    "title": "Clattering Skeleton",
                    "health": 2,
                    "time": 1,
                    "effects" : [
                        "1A: Apply -1T",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Slithering Snake",
                    "health": 2,
                    "time": 1,
                    "effects" : [
                        "1A: Trash a card from your discard pile",
                        "1A: Deal 1D damage"
                    ]
                }
            ],
            "actions": [
                {
                    "title": "Knife",
                    "time": 1,
                    "type": "Attack",
                    "effects": [
                        "Deal 1D"
                    ],
                    "leftEffects": [
                        "1D"
                    ]
                },
                {
                    "title": "Bolt",
                    "time": 1,
                    "type": "Attack Spell",
                    "effects": [
                        "Deal 1D or draw a card"
                    ],
                    "leftEffects": [
                        "1D"
                    ],
                    "rightEffects": [
                        ""
                    ]
                },
                {
                    "title": "Hit and Run",
                    "time": 1,
                    "type": "Maneuver",
                    "effects": [
                        "Costs -1T if following an Attack",
                        "Draw a card"
                    ],
                    "leftEffects": [""]
                },
                {
                    "title": "Rapier",
                    "time": 2,
                    "type": "Attack",
                    "effects": [
                        "Deal 2D"
                    ],
                    "leftEffects": [
                        "2D"
                    ]
                },
                {
                    "title": "Heavy Axe",
                    "time": 3,
                    "type": "Attack",
                    "effects": [
                        "Costs -1T if this is the first action in the turn",
                        "Deal 3D"
                    ],
                    "leftEffects": [
                        "3D"
                    ]
                },
                {
                    "title": "Foresight",
                    "time": 1,
                    "type": "Maneuver Spell",
                    "effects": [
                        "Draw 2 cards"
                    ],
                    "leftEffects": [
                        "Draw 2 cards"
                    ]
                },
                {
                    "title": "Throwing Axe",
                    "time": 1,
                    "type": "Attack",
                    "effects": [
                        "/R[1-3] You may spend 1T to return this to hand",
                        "/R[4-6] Deal 3D"
                    ],
                    "leftEffects": [
                        "3D",
                        "/W"
                    ]
                },
                {
                    "title": "Plan of Attack",
                    "time": 0,
                    "type": "Maneuver",
                    "effects": [
                        "Follow up attack costs -1T"
                    ],
                    "leftEffects": [
                        "/F"
                    ]
                },
                {
                    "title": "Take the initiative",
                    "time": 1,
                    "type": "Maneuver",
                    "effects": [
                        "Follow up attack costs -2T if this monster is undamaged"
                    ],
                    "leftEffects": [
                        "/F"
                    ]
                }
            ],
            "items": [
                {
                    "title": "Mana Visor",
                    "effects": [
                        "1T: Peek at an adjacent tile",
                        "/E: Choose up to 3 tiles adjacent to revealed tiles. Reveal them in any order."
                    ]
                },
                {
                    "title": "Adrenaline Band",
                    "effects": [
                        "Whenever you take damage, inflict +1T. This only triggers once per turn.",
                        "/E: Inflict +3T"
                    ]
                },
                {
                    "title": "Knowledge Tome",
                    "effects": [
                        "1T: Draw a card",
                        "/E: Draw cards until your hand is full"
                    ]
                },
                {
                    "title": "Wind Boots",
                    "effects": [
                        "You may move up to two tiles instead of one over revealed tiles",
                        "/E: Instantly move to any revealed tile"
                    ]
                }
            ],
            "events": [
                {
                    "title": "Healing Fountain",
                    "type": "Room",
                    "effects": [
                        "/E: Recover 3 health"
                    ]
                },
                {
                    "title": "Treasure Chest",
                    "type": "Room",
                    "effects": [
                        "/E: Draw 2 cards"
                    ]
                },
                {
                    "title": "Trade Under Duress",
                    "type": "Event",
                    "effects": [
                        "Trash the top card of your deck.",
                        "Put the top card of the /S action deck on top of your deck."
                    ]
                },
                {
                    "title": "Safe Room",
                    "type": "Room",
                    "effects": [
                        "You can't play attack actions.",
                        "Monsters skip their actions."
                    ]
                },
                {
                    "title": "Wandering Wares",
                    "type": "Event",
                    "effects": [
                        "Draw 2 cards from the /S action deck. Trash a card from your hand."
                    ]
                }
            ]
        },
        "level2": {
            "monsters": [
                {
                    "title": "Dissolving Slime",
                    "health": 4,
                    "time": 2,
                    "effects" : [
                        "1A: Discard an action attached to a monster",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Ruthless Goblin",
                    "health": 6,
                    "time": 1,
                    "effects" : [
                        "1A: /R[1-2] Deal 3D damage",
                        "1A: Deal 2D damage and apply +2T"
                    ]
                },
                {
                    "title": "Twinkling Faerie",
                    "health": 5,
                    "time": 2,
                    "effects" : [
                        "2A: Hide a card from your hand. If this monster has 3 or more cards hidden, trash them all and defeat this monster",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Iron Golem",
                    "health": 7,
                    "time": 1,
                    "effects" : [
                        "1A: Deal 1D damage",
                        "1A: Move an attack from another monster to this monster"
                    ]
                },
                {
                    "title": "Clattering Skeleton",
                    "health": 4,
                    "time": 1,
                    "effects" : [
                        "1A: Apply -2T",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Slithering Snake",
                    "health": 5,
                    "time": 1,
                    "effects" : [
                        "1A: Trash a card from your hand and draw a card",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Supporting Wizard",
                    "health": 4,
                    "time": 1,
                    "effects" : [
                        "When this monster is summoned, summon a /S monster",
                        "1A: The next monster gains +1A (can't activate if no monster after this one)",
                        "1A: Deal 1D damage" 
                    ]
                },
                {
                    "title": "Swiftness buff",
                    "health": 0,
                    "time": 0,
                    "effects" : [
                        "Summon a /S monster and give it +1A"
                    ],
                    "rightEffects": [
                        "+1A"
                    ]
                }
            ],
            "actions": [
                {
                    "title": "Dart",
                    "time": 0,
                    "type": "Attack",
                    "effects": [
                        "Deal 1D"
                    ],
                    "leftEffects": [
                        "1D"
                    ]
                },
                {
                    "title": "Burning Book",
                    "time": 1,
                    "type": "Attack Spell",
                    "effects": [
                        "Deal 2D and draw 2 cards",
                        "/R[1-3] Discard a card"
                    ],
                    "leftEffects": [
                        "2D"
                    ]
                },
                {
                    "title": "Shield Bash",
                    "time": 2,
                    "type": "Attack",
                    "effects": [
                        "Deal 1D",
                        "If this is the last action in the turn, the affected monster skips its next turn"
                    ],
                    "leftEffects": [
                        "1D"
                    ]
                },
                {
                    "title": "Seed of Knowledge",
                    "time": 3,
                    "type": "Attack Spell",
                    "effects": [
                        "This attack's damage is equal to the number of cards in your hand"
                    ],
                    "leftEffects": [
                        "#/C/D"
                    ]
                },
                {
                    "title": "Clean Slate",
                    "time": 1,
                    "type": "Maneuver",
                    "effects": [
                        "Deal 1D",
                        "Discard your hand and draw 3 cards"
                    ],
                    "leftEffects": [
                        "1D"
                    ]
                },
                {
                    "title": "Dash Attack",
                    "time": 1,
                    "type": "Attack",
                    "effects": [
                        "Deal 2D",
                        "Move 1 tile"
                    ],
                    "leftEffects": [
                        "2D"
                    ]
                },
                {
                    "title": "Confusion Spell",
                    "time": 1,
                    "type": "Attack Spell",
                    "effects": [
                        "This attack's damage is equal to the number of enemies in play"
                    ],
                    "leftEffects": [
                        "#/M/D"
                    ]
                },
                {
                    "title": "Assassin's Glass Dagger",
                    "time": 2,
                    "type": "Attack",
                    "effects": [
                        "Defeat the monster",
                        "/R[1-3] Trash this card"
                    ]
                }
            ],
            "items": [
                {
                    "title": "Spatial Cube",
                    "effects": [
                        "1T: Hide a room you standing on",
                        "/E: Place a hidden room on the board"
                    ]
                },
                {
                    "title": "Soul Gem",
                    "effects": [
                        "When you defeat a monster, gain 1 health",
                        "/E: Gain health equal to the number of actions attached to monsters"
                    ]
                },
                {
                    "title": "EXP Share",
                    "effects": [
                        "When you defeat a monster, look at 3 reward cards instead of 2",
                        "/E: Gain all reward cards being looked at"
                    ]
                },
                {
                    "title": "Thrark's Third Thumb",
                    "effects": [
                        "Once per turn, you may add or subtract 1 from any die roll (can not be lower than 1 or higher than 6)",
                        "1T/E: Until the start of your next turn, choose the result of any die roll"
                    ]
                },
                {
                    "title": "Sword of the Fallen",
                    "effects": [
                        "When you defeat a monster, gain +1A",
                        "/E: Gain +1A"
                    ]
                },
                {
                    "title": "Recycling Bin",
                    "effects": [
                        "Whenever you trash an action card, you may use 1T. If you do, draw a action card of the same level"
                    ]
                }
            ],
            "events": [
                {
                    "title": "Healing Fountain",
                    "type": "Room",
                    "effects": [
                        "/E: Recover 4 health"
                    ]
                },
                {
                    "title": "Treasure Chest",
                    "type": "Room",
                    "effects": [
                        "/E: Draw 2 cards from the /S action deck"
                    ]
                },
                {
                    "title": "Trade Under Duress",
                    "type": "Event",
                    "effects": [
                        "Trash the top card of your deck.",
                        "Put the top card of the /S/S action deck on top of your deck."
                    ]
                },
                {
                    "title": "Safe Room",
                    "type": "Room",
                    "effects": [
                        "You can't play attack actions.",
                        "Monsters skip their actions.",
                        "Moving out of the safe room doesn't cost any time."
                    ]
                },
                {
                    "title": "Wandering Merchant",
                    "type": "Event",
                    "effects": [
                        "Draw 2 cards from the /S action deck. Trash a card from your hand."
                    ]
                },
                {
                    "title": "Snake Oil Salesman",
                    "type": "Event",
                    "effects": [
                        "You may take a heath dice and roll it."
                    ]
                }
            ]
        },
        "level3": {
            "monsters": [
                {
                    "title": "Dissolving Slime",
                    "health": 7,
                    "time": 2,
                    "effects" : [
                        "1A: Trash an action attached to a monster",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Ruthless Goblin",
                    "health": 10,
                    "time": 1,
                    "effects" : [
                        "1A: /R[1-2] Deal 3D damage",
                        "1A: Deal 2D damage and apply +2T"
                    ]
                },
                {
                    "title": "Twinkling Faerie",
                    "health": 8,
                    "time": 2,
                    "effects" : [
                        "2A: Hide a card from your hand. If this monster has 3 or more cards hidden, trash them all and defeat this monster",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Iron Golem",
                    "health": 14,
                    "time": 1,
                    "effects" : [
                        "1A: Deal 1D damage",
                        "1A: Move an attack from another monster to this monster"
                    ]
                },
                {
                    "title": "Clattering Skeleton",
                    "health": 6,
                    "time": 1,
                    "effects" : [
                        "1A: Apply -2T",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Slithering Snake",
                    "health": 10,
                    "time": 1,
                    "effects" : [
                        "1A: Trash a card from your hand and draw a card",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Supporting Wizard",
                    "health": 6,
                    "time": 1,
                    "effects" : [
                        "When this monster is summoned, summon a monster from the /S action deck",
                        "1A: The next monster gains +1A (can't activate if no monster after this one)",
                        "1A: Deal 1D damage"
                    ]
                },
                {
                    "title": "Swiftness buff",
                    "health": 0,
                    "time": 0,
                    "effects" : [
                        "Summon a /S monster and give it +2A"
                    ],
                    "rightEffects": [
                        "+2A"
                    ]
                }
            ],
            "actions": [
    
            ],
            "items": [
    
            ],
            "events": [
    
            ]
        }
    }

    function loadCardsFromJSON() {
        const file = "./cardData.json";
        fetch(file)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                cards = {...data};
            }).then(run);
    }
    loadCardsFromJSON();
    //document.onload += run();
</script>
</body>
</html>